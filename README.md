# Database Service API

## Overview
This service is for communicating with the database. This API is implemented using 
[FASTApi](https://fastapi.tiangolo.com/). The database is modeled using SQLAlchemy's ORM package.

### Project Structure
- **database_service**
    - **api:**  
        This package contains api endpoints. Json responses are handled here. There should be function for each endpoint.
      - `deps.py`: FastAPI [dependencies](https://fastapi.tiangolo.com/tutorial/dependencies/) are here.
      - `api.py`: joins seperate routers into a single api. API wide parameters/dependencies etc. can be defined here.  
    - **common:**  
      This package contains any code that needs to be referenced in multiple different packages but does not need a 
      dedicated category. Things like authentication, security and utility functions.
    - **crud:**  
      Modules in this package implement crud functionality for sqlalchemy models, so they can be used in api
      package. Any queries or database object creation methods are implemented here. This allows the code to be tested
      more easily.
    - **db:**  
      SQLAlchemy database connection, initialization and configuration are handled here.
    - **models:**  
      SQLAlchemy ORM models are here. `base.py` contains only abstract tables. If a new schema needs to be created, create a separate
      module and extend the classes present in base class. See `binance.py` and `binance_assets.py` for an example.
    - **schemas:**  
      Pydantic models are here. Models defined here are used in endpoint functions and they are automatically included
      in OpenAPI specifications.
      
- **migrations**  
  This folder is generated by [Alembic](https://alembic.sqlalchemy.org/en/latest/). 

## Setup
Install PostgreSQL and run the sql code in `init.sql` in psql terminal to create a database and schemas.
Following environment variables are required for this project to run:

    POSTGRES_SERVER = hostIP:port 
    POSTGRES_USER = "myuser"
    POSTGRES_PASSWORD = "mypass" 
    POSTGRES_DB = "mydatabasename"

## Requirements
This project requires Python 3.7+ to run. Using a virtual environment is recommended.
``` 
  pip install requirements.txt
```

## Usage
In the base folder of the project, activate virtualenv and run the following command `uvicorn main:app`. Include 
`--reload` to enable hot reload.
```yaml
base_url: localhost://8000
openapi.json: /openapi.json
openapi-ui: /docs
redocs: /redoc
```

All functionality of the api can be tested interactively using the available documentation in the above url.

## Docker

Docker functionality will be added.